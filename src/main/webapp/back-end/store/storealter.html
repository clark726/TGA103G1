<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Document</title>
<link rel="stylesheet" href="../../css/storealter.css">
<link rel="stylesheet" href="../../css/header.css" />
</head>
<body style="background-color: rgb(129, 93, 65)">
	<div id="xxx"></div>

	<div class="contain">
		<aside class="aside">
			<p id="p1">廠商後台</p>
			<div class="div_func">
				<div>
					<a class="edit_store" type="button">修改店家內容</a>
				</div>
				<div>
					<a class="manager_item" type="button"
						href="../product/productlist.jsp">上下架商品管理</a>
				</div>
				<div>
					<a class="edit_item" type="button">修改商家訂單內容</a>
				</div>

			</div>
		</aside>
		<main class="main">
			<form action="" method="post">
				<div class="store_all">
					<div class="title">
						<h1>店家首頁</h1>
					</div>
					<div class="store_produce">
						<h2>簡介</h2>
						<textarea name="store_produce" id="textarea" cols="50" rows="3"></textarea>
						<span id="errMsg" class="error"
							style="color: yellow; font-size: 20px"></span>
					</div>

					<div class="store_produce">
						<h2>營業開始</h2>
						<input type="text" id="work_open" class="time">
						<h2>營業結束</h2>
						<input type="text" id="work_end" class="time">
						<h2>公休日期</h2>
						<input type="text" id="dayoff" class="time">
					</div>

					<div class="store_produce">
						<h2>環境照片</h2>
						<div class="file">
							<input type="file" id="p_file1">
							<div class="preview" id="preview1">
								<span class="text" id="text1" >首圖</span>
							</div>
						</div>

						<div class="file">
							<input type="file" id="p_file2">
							<div class="preview" id="preview2">
								<span class="text" id="text2">內頁一</span>
							</div>
						</div>

						<div class="file">
							<input type="file" id="p_file3">
							<div class="preview" id="preview3">
								<span class="text" id="text3" >內頁二</span>
							</div>
						</div>
					</div>

					<div class="store_produce">
						<h2>菜單</h2>
						<div class="file">
							<input type="file" id="p_file4">
							<div class="preview" id="preview4">
								<span class="text" id="text4">菜單一</span>
							</div>
						</div>
						<div class="file">
							<input type="file" id="p_file5">
							<div class="preview" id="preview5">
								<span class="text" id="text5">菜單二</span>
							</div>
						</div>
						<div class="button">

							<div class="inner_button">

								<button type="button" id="updatebtn">更新</button>
							</div>
							<div class="inner_button">
								<button type="">取消</button>
							</div>
						</div>
					</div>


				</div>
			</form>
		</main>
	</div>

	</div>
	<script>
   
   function includeHTML() {
        const xxx = document.querySelector("#xxx");
        fetch("/TGA103G1/com/header.html")
          .then((resp) => resp.text())
          .then((content) => {
            xxx.innerHTML = content;
            changelog();

            const username = document.querySelector("#account");
            const password = document.querySelector("#password");
            const errMsg = document.querySelector("#errMsg");
            document.getElementById("btn1").addEventListener("click", () => {
              fetch("/TGA103G1/StoreLogin", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  account: username.value,
                  password: password.value,
                }),
              })
                .then((resp) => resp.json())
                .then((body) => {
                  errMsg.textContent = "";
                  const { successful, message } = body;
                  if (successful) {
                    const { account, password } = body;
                    sessionStorage.setItem("account", account);
                    sessionStorage.setItem("password", password);
                    location = "/TGA103G1/ShowProduct";
                  } else {
                    errMsg.textContent = message;
                  }
                });
            });
          });
      }
      includeHTML();
      let mainImgReader = new FileReader();
      let firstImgReader = new FileReader();
      let secondImgReader = new FileReader();
      let menauImg1 = new FileReader();
      let menauImg2 = new FileReader();
      //首頁
      document.querySelector("#p_file1").addEventListener("change", function(e){
        if(this.files.length > 0){
          document.querySelector("#preview1").innerHTML="";
          
          mainImgReader.readAsDataURL(this.files[0]);
          mainImgReader.addEventListener("load", function(){
          
          let str = `
            <img src="${mainImgReader.result}" class="preview_img" >
          `;
          document.querySelector("#preview1").innerHTML = str;
           
        });
      
        }else{
          document.querySelector("#text1").innerText="預覽圖";
        };
      });
  
      // 內頁一
      document.querySelector("#p_file2").addEventListener("change", function(e){
        if(this.files.length > 0){
          document.querySelector("#preview2").innerHTML="";
          firstImgReader.readAsDataURL(this.files[0]);
          firstImgReader.addEventListener("load", function(){
          
          let str = `
            <img src="${firstImgReader.result}" class="preview_img" >
          `;
          document.querySelector("#preview2").innerHTML = str;
         
        });
      
        }else{
          document.querySelector("#text2").innerText="內頁一";
        };
      });

      //內頁二

      document.querySelector("#p_file3").addEventListener("change", function(e){
        if(this.files.length > 0){
          document.querySelector("#preview3").innerHTML="";
          secondImgReader.readAsDataURL(this.files[0]);
          secondImgReader.addEventListener("load", function(){
          
          let str = `
            <img src="${secondImgReader.result}" class="preview_img" >
          `;
          document.querySelector("#preview3").innerHTML = str;
         
        });
      
        }else{
          document.querySelector("#text3").innerText="內頁二";
        };
      });

      //菜單一

      document.querySelector("#p_file4").addEventListener("change", function(e){
        if(this.files.length > 0){
          document.querySelector("#preview4").innerHTML="";
          menauImg1.readAsDataURL(this.files[0]);
          menauImg1.addEventListener("load", function(){
          
          let str = `
            <img src="${menauImg1.result}" class="preview_img" >
          `;
          document.querySelector("#preview4").innerHTML = str;
         
        });
      
        }else{
          document.querySelector("#text4").innerText="內頁二";
        };
      });

      //菜單二

      document.querySelector("#p_file5").addEventListener("change", function(e){
        if(this.files.length > 0){
          document.querySelector("#preview5").innerHTML="";
          menauImg2.readAsDataURL(this.files[0]);
          menauImg2.addEventListener("load", function(){
          
          let str = `
            <img src="${menauImg2.result}" class="preview_img" >
          `;
          document.querySelector("#preview5").innerHTML = str;
         
        });
      
        }else{
          document.querySelector("#text5").innerText="內頁二";
        };
      });


      (() => {
  const textarea = document.querySelector('#textarea');
  const work_open = document.querySelector('#work_open');
  const work_end = document.querySelector('#work_end');
  const dayoff = document.querySelector('#dayoff');
  const errMsg = document.querySelector("#errMsg");
  
  document.getElementById('updatebtn').addEventListener('click', () => {
    fetch('/TGA103G1/StoreUpdate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        work_open: work_open.value,
        work_end: work_end.value,
        produce:textarea.value,
        dayoff: dayoff.value
      }),
    })
      .then(resp => resp.json() )
      .then(body => {
        
        errMsg.textContent = "";
        const { successful, message } = body;
         if (successful) {

         } else {
           errMsg.textContent = message;
         }

          //圖片
      fetch('/TGA103G1/StoreImgUpdate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        img: mainImgReader.result,
        firstImg: firstImgReader.result,
        secondImg: secondImgReader.result,
        meanuImg: menauImg1.result,
        meanuImg2: menauImg2.result,
    
      }),
    })
      .then(resp => resp.json() )
      .then(body => {
        console.log(body);
        console.log(mainImgReader.result)
        errMsg.textContent = "";
        const { successful, message } = body;
         if (successful) {
           location = 'http://localhost:8080/TGA103G1/back-end/store/storealter.html';
         
         } else {
           errMsg.textContent = message;
         }
      });
      });
    
      

  });
})();

function changelog(){
			
			if(sessionStorage.getItem("account")){
            document.querySelector("#login").style.display='none'
            document.querySelector("#logout").style.display='block'
          }
		}
changelog()

    </script>
 
</body>
</html>
