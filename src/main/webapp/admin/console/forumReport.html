<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Document</title>
<link rel="stylesheet" href="/TGA103G1/admin/css/header.css" />
<link rel="stylesheet" href="/TGA103G1/admin/css/back.css">
<style>
td {
	border: 1px solid black;
}

.table {
 	display: flex; 
 	justify-content: center; 
	align-items: center;
}
</style>
</head>
<body>
	<header class="header">
		<div class="fl_left">
			<h1 id="logo_h1">
				<a href="＃" id="logo">Bar.Jar.Jo</a>
			</h1>
		</div>

		<nav class="fl_right">
			<ul class="nav_ul">
				<li><a href="#">HOME</a></li>
				<li><a href="#">地圖</a></li>
				<li><a href="#">討論區</a></li>
				<li><a href="#">廠商專區</a></li>
				<li><a href="#" class="icon">店家主題</a>
					<ul id="store">
						<li><a href="#">Bistro</a></li>
						<li><a href="#">Cocktail bar</a></li>
						<li><a href="#">Whisky bar</a></li>
					</ul></li>
				<li><a href="#" class="icon">會員專區</a>
					<ul id="store">
						<li><a href="#">我的最愛</a></li>
						<li><a href="#">修改會員資料</a></li>
						<li><a href="#">修改密碼</a></li>
						<li><a href="#">訂單管理</a></li>
					</ul></li>

				<li><a href="#">購物商城</a></li>
				<li><a href="/TGA103G1/control">登出</a></li>
			</ul>
		</nav>
	</header>

	<div class="contain">
		<aside class="aside">
			<p id="p1">管理者後台</p>
			<div class="div_func">
				<div>
					<a class="edit_store" href="/TGA103G1/admin/console/members.jsp?">修改會員資料</a>
				</div>
				<div>
					<a class="manager_item" type="button">上下架商品管理</a>
				</div>
				<div>
					<a class="edit_item" type="button">修改商家訂單內容</a>
				</div>
				<hr>
				<div>
					<a class="front_paga"
						href="/TGA103G1/admin/console/messageReport.jsp">留言檢舉</a>
				</div>
				<div>
					<a class="forum">文章檢舉</a>
				</div>
				<div>
					<a class="audit" type="button">審核上架</a>
				</div>
				<div>
					<a class="change_state" type="button">改變帳號狀態</a>
				</div>
				<div>
					<a class="manager" type="submit">..</a>
				</div>
			</div>
		</aside>

		<main class="main">

			<hr>
			<div class="table">
			<table>
				<tr>
					<td>id</td>
					<td>member</td>
					<td>forum</td>
					<td>reason</td>
					<td>date</td>
					<td>watch</td>
					<td>seen</td>
					<td>delete</td>
				</tr>

			</table>
			</div>
		</main>
	</div>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<script>
		window.onload = function() {
			$.ajax({
						url : "/TGA103G1/control",
						type : "post",
						data : {
							"action" : "getAllforumReport",
						},
						dataType : "json",
						beforeSend : function() {
						},
						headers : {},
						statusCode : {
							200 : function(res) {
							},
							404 : function(res) {
							},
							500 : function(res) {
							}
						},
						success : function(xhr) {
							for (var x = 0; x < xhr.length; x++) {
								if (xhr[x].status == 0) {
									var tableObject = document
											.querySelector("table");
									var trEl = document.createElement("tr");
									var tdEl1 = document.createElement("td");
									tdEl1
											.appendChild(document
													.createTextNode(xhr[x].forum_report_id));
									var tdEl2 = document.createElement("td");
									tdEl2.appendChild(document
											.createTextNode(xhr[x].member_id));
									var tdEl3 = document.createElement("td");
									tdEl3.appendChild(document
											.createTextNode(xhr[x].forum_id));
									var tdEl4 = document.createElement("td");
									tdEl4.appendChild(document
											.createTextNode(xhr[x].reason));
									var tdEl5 = document.createElement("td");
// 									tdEl5.appendChild(document.createTextNode(new Date(xhr[x].date)));
									tdEl5.appendChild(document.createTextNode(xhr[x].date));

									var btn1 = document.createElement("button");
									btn1.setAttribute("type", "button");
									btn1.setAttribute("class", "search");
									btn1.appendChild(document
											.createTextNode("search"));
									var tdEl6 = document.createElement("td");
									tdEl6.appendChild(btn1);

									var btn2 = document.createElement("button");
									btn2.setAttribute("class", "seen");
									btn2.appendChild(document
											.createTextNode("seen"));
									var tdEl7 = document.createElement("td");
									tdEl7.appendChild(btn2);

									var btn3 = document.createElement("button");
									btn3.setAttribute("class", "delete");
									btn3.appendChild(document
											.createTextNode("delete"));
									var tdEl8 = document.createElement("td");
									tdEl8.appendChild(btn3);

									trEl.appendChild(tdEl1);
									trEl.appendChild(tdEl2);
									trEl.appendChild(tdEl3);
									trEl.appendChild(tdEl4);
									trEl.appendChild(tdEl5);
									trEl.appendChild(tdEl6);
									trEl.appendChild(tdEl7);
									trEl.appendChild(tdEl8);
									tableObject.appendChild(trEl);
								}
							}
						},
						error : function(xhr) {
							console.log("error");
							console.log(xhr);
						},
						complete : function(xhr) {
						}
					});
		}
		$("table").on("click",".search",function(e){
			var forumId = e.currentTarget.closest("tr").children[2].innerText;
			$.ajax({
	        url: "/TGA103G1/control",           
	        type: "post",                  
	        data: {"action":"readForum",
			        "forumId":forumId},              
	        dataType: "text",            
	        beforeSend: function(){     
	        },
	        headers: {},
	        statusCode: {                
	          200: function (res) {},
	          404: function (res) {},
	          500: function (res) {}
	        },
	        success: function(xhr){
				alert(xhr);
	        },
	        error: function(xhr){
				console.log("error");         
	            console.log(xhr);
	        },
	        complete: function(xhr){}
	      });
		})
		
					$("table").on("click",".seen",function(e){
			var trEl = e.currentTarget.closest("tr");
			var forumId = e.currentTarget.closest("tr").children[0].innerText;
			$.ajax({
	        url: "/TGA103G1/control",           
	        type: "post",                  
	        data: {"action":"seenForum",
			        "forumReport":forumId},
			dataType:"text",
	        beforeSend: function(){     
	        },
	        headers: {},
	        statusCode: {                
	          200: function (res) {},
	          404: function (res) {},
	          500: function (res) {}
	        },
	        success: function(xhr){
				trEl.remove();
				alert(xhr);
	        },
	        error: function(xhr){
				console.log("error");         
	            console.log(xhr);
	        },
	        complete: function(xhr){}
	      });
		})
		
			$("table").on("click",".delete",function(e){
			var trEl = e.currentTarget.closest("tr");
			var forumId = e.currentTarget.closest("tr").children[2].innerText;
			var reportId = e.currentTarget.closest("tr").children[0].innerText;
			$.ajax({
	        url: "/TGA103G1/control",           
	        type: "post",                  
	        data: {"action":"deleteForum",
			        "forumId":forumId,
					"reportId":reportId},              
	        dataType: "text",            
	        beforeSend: function(){     
	        },
	        headers: {},
	        statusCode: {                
	          200: function (res) {},
	          404: function (res) {},
	          500: function (res) {}
	        },
	        success: function(xhr){
				alert(xhr);
				trEl.remove();
	        },
	        error: function(xhr){
				console.log("error");         
	            console.log(xhr);
	        },
	        complete: function(xhr){}
	      });
		})
	</script>
</body>
</html>
